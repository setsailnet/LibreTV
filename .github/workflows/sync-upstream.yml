name: Sync Upstream

on:
  schedule:
    # æ¯å¤© UTC æ—¶é—´å‡Œæ™¨ 3 ç‚¹è¿è¡Œ
    # è¯·æ³¨æ„ï¼ŒUTC å‡Œæ™¨ 3 ç‚¹ç›¸å½“äºæ—¥æœ¬æ—¶é—´ (JST) ä¸­åˆ 12 ç‚¹
    - cron: "0 3 * * *"
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write # æˆäºˆå†™å…¥å†…å®¹æƒé™ï¼Œä»¥ä¾¿æ¨é€åˆ°ä»“åº“

jobs:
  sync:
    runs-on: ubuntu-latest # åœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä¸Šè¿è¡Œ
    steps:
      - name: Checkout repository # æ£€å‡ºä½ çš„ä»“åº“ä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # è·å–å®Œæ•´å†å²è®°å½•ï¼Œä»¥ä¾¿è¿›è¡Œåˆå¹¶

      - name: Add upstream remote and fetch # æ·»åŠ ä¸Šæ¸¸è¿œç¨‹ä»“åº“å¹¶è·å–æ›´æ–°
        run: |
          git remote add upstream https://github.com/LibreSpark/LibreTV.git || true # å¦‚æœå·²å­˜åœ¨ï¼Œåˆ™å¿½ç•¥é”™è¯¯
          git fetch upstream

      - name: Merge upstream into main # åˆå¹¶ä¸Šæ¸¸çš„ main åˆ†æ”¯åˆ°ä½ çš„ main åˆ†æ”¯
        run: |
          # å°è¯•åˆå¹¶ï¼Œå¦‚æœå‘ç”Ÿå†²çªåˆ™å¤±è´¥
          git merge upstream/main -m "ğŸ”„ Sync from upstream"
        env:
          # è®¾ç½® GIT_COMMITTER_NAME å’Œ GIT_COMMITTER_EMAIL æ¥å®šä¹‰åˆå¹¶æäº¤çš„ä½œè€…ä¿¡æ¯
          GIT_COMMITTER_NAME: github-actions[bot]
          GIT_COMMITTER_EMAIL: 41898282+github-actions[bot]@users.noreply.github.com

      - name: Push changes # æ¨é€åˆå¹¶åçš„æ›´æ”¹åˆ°ä½ çš„ä»“åº“
        run: |
          git push origin main
        env:
          # ä½¿ç”¨ GITHUB_TOKEN è¿›è¡Œè®¤è¯
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
